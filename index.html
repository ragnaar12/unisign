<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniSign - Langue des Signes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        header {
            background-color: #2c3e50;
            color: white;
            width: 100%;
            padding: 20px;
            text-align: center;
        }

        h1 {
            margin: 0;
            font-size: 2.5em;
        }

        section {
            margin: 20px;
            text-align: center;
        }

        #camera-activation {
            margin: 20px 0;
        }

        #video-display {
            margin-top: 30px;
        }

        video {
            border: 2px solid #ccc;
            margin-top: 20px;
        }

        footer {
            margin-top: 30px;
            font-size: 0.9em;
            color: #888;
        }

        #label-placeholder {
            margin-top: 10px;
            font-size: 1.5em;
            color: #333;
        }
    </style>
</head>
<body>
    <header>
        <h1>Bienvenue sur UniSign ğŸ–ï¸</h1>
        <p>SystÃ¨me de traduction des gestes en Langue des Signes</p>
    </header>
    
    <section>
        <h2>ğŸ–ï¸ UniSign - MVP</h2>
        <p>Nous traduisons les gestes en Langue des Signes en temps rÃ©el.</p>
        <p>Veillez Ã  activer votre camÃ©ra pour tester le systÃ¨me.</p>
        <div id="camera-activation">
            <label for="camera-toggle">Activer la camÃ©ra:</label>
            <input type="checkbox" id="camera-toggle">
        </div>
    </section>

    <section id="video-display">
        <h3>VidÃ©o en direct:</h3>
        <video id="webcam" width="640" height="480" autoplay></video>
        <div id="label-placeholder">
            <p>Pas de main dÃ©tectÃ©e...</p>
        </div>
    </section>

    <footer>
        <p>Â© 2025 UniSign - Un projet pour faciliter l'apprentissage de la Langue des Signes.</p>
    </footer>

    <script>
        const cameraToggle = document.getElementById('camera-toggle');
        const webcam = document.getElementById('webcam');
        const labelPlaceholder = document.getElementById('label-placeholder');

        let videoStream = null;

        cameraToggle.addEventListener('change', async () => {
            if (cameraToggle.checked) {
                try {
                    // Demande l'accÃ¨s Ã  la camÃ©ra
                    videoStream = await navigator.mediaDevices.getUserMedia({
                        video: true,
                    });
                    webcam.srcObject = videoStream;
                } catch (error) {
                    console.error("Erreur lors de l'accÃ¨s Ã  la camÃ©ra", error);
                    labelPlaceholder.innerHTML = "Impossible d'activer la camÃ©ra.";
                }
            } else {
                if (videoStream) {
                    const tracks = videoStream.getTracks();
                    tracks.forEach(track => track.stop());
                }
                webcam.srcObject = null;
                labelPlaceholder.innerHTML = "CamÃ©ra dÃ©sactivÃ©e.";
            }
        });
    </script>

    <!-- Le code Streamlit pour le backend -->
    <script type="module">
        import streamlit from "https://cdn.jsdelivr.net/npm/streamlit-component-lib@0.1.0/dist/streamlit-component-lib.js";
        
        const st = streamlit.create();
        
        st.title("ğŸ–ï¸ UniSign - MVP");
        st.write("Ù†Ø¸Ø§Ù… ØªØ±Ø¬Ù…Ø© Ø¨Ø³ÙŠØ· Ù„Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ø¨Ù„ØºØ© Ø§Ù„Ø¥Ø´Ø§Ø±Ø©");

        const mp_hands = mp.solutions.hands;
        const hands = new mp_hands.Hands({ max_num_hands: 1 });
        const mp_draw = mp.solutions.drawing_utils;

        const run = st.checkbox('ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§');

        const frame_placeholder = st.empty();
        const label_placeholder = st.empty();

        const cap = new cv2.VideoCapture(0);

        // Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø³ÙŠØ· Ø¬Ø¯Ø§: Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµØ§Ø¨Ø¹ Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© ÙÙ‚Ø·
        function count_fingers(hand_landmarks) {
            const finger_tips = [8, 12, 16, 20];
            let count = 0;
            for (const tip of finger_tips) {
                if (hand_landmarks.landmark[tip].y < hand_landmarks.landmark[tip - 2].y) {
                    count += 1;
                }
            }
            return count;
        }

        while (run) {
            const ret, frame = cap.read();
            if (!ret) break;
            const rgb_frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB);
            const result = hands.process(rgb_frame);

            let label = "ğŸ‘‹ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙŠØ¯";

            if (result.multi_hand_landmarks) {
                for (const hand_landmarks of result.multi_hand_landmarks) {
                    mp_draw.draw_landmarks(frame, hand_landmarks, mp_hands.HAND_CONNECTIONS);
                    const finger_count = count_fingers(hand_landmarks);
                    if (finger_count === 0) {
                        label = "âœŠ Ø¥Ø´Ø§Ø±Ø©: A";
                    } else if (finger_count === 1) {
                        label = "â˜ï¸ Ø¥Ø´Ø§Ø±Ø©: D";
                    } else if (finger_count === 2) {
                        label = "âœŒï¸ Ø¥Ø´Ø§Ø±Ø©: V";
                    } else if (finger_count === 5) {
                        label = "ğŸ–ï¸ Ø¥Ø´Ø§Ø±Ø©: Salut";
                    } else {
                        label = `ğŸ¤Ÿ Ø¹Ø¯Ø¯ Ø£ØµØ§Ø¨Ø¹: ${finger_count}`;
                    }
                }
            }

            label_placeholder.markdown(`### ${label}`);
            frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB);
            frame_placeholder.image(frame, { channels: "RGB" });
        }

        cap.release();
    </script>
</body>
</html>
